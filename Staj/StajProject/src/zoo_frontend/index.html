<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Zoo Management System</title>
<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="https://cdn.datatables.net/2.3.2/css/dataTables.dataTables.min.css">
</head>
<body>
<h1>Zoo Management Systemüêæ</h1>

<div class="animal-selection">
<label for="animalInput">Girmek istediƒüiniz Hayvanƒ±n adƒ±nƒ± giriniz:</label><br>
<input type="text" id="animalInput" placeholder="√∂rneƒüin: Kaplan">
<button onClick="selectAnimal()">Kaydet</button>
<button onClick="listAnimal()">Listele</button>
<button onClick="remove()">Sil</button>
<button onClick="editAnimal()">D√ºzenle</button>
</div>

<div id="form-container"></div>

<h2>Hayvan Listesi</h2>
<table id="myTable" class="animal-table display">
<thead>
<tr>
	<th>ID</th>
	<th>Ad</th>
	<th>Ya≈ü</th>
	<th>Boy</th>
	<th>Kilo</th>
	<th>Hƒ±z</th>
	<th>Renk</th>
	<th>ƒ∞≈ülemler</th>
</tr>	
</thead>
<tbody id="animalList"></tbody>
</table>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/2.3.2/js/dataTables.min.js"></script>
  <script>
  let dataTable = null;
  
  function selectAnimal(){
	  const animalName = document.getElementById('animalInput').value.trim();
	  const formContainer = document.getElementById('form-container');

	 if(!animalName){
		 formContainer.innerHTML="<p style='color:red;'> L√ºtfen bir hayvan giriniz.</p>";
		 return;
	 }
	 
	 formContainer.innerHTML= `
	 <h2>${animalName} √ñzellik Giri≈üi</h2>
	 <form id="animalForm">
	 <div class="form-row">
	 <div class="form-group">
	 <label>Ya≈ü:</label>
	 <input type="number" id="age" placeholder="Ya≈ü"><br>
	 </div>
	 <div class="form-group">
	 <label>Boy(cm):</label>
	 <input type="number" id="height" placeholder="Boy"><br>
	 </div>
	 <div class="form-group">
	 <label>Kilo(kg):</label>
	 <input type="number" id="weight" placeholder="Kilo"><br>
	 </div>
	 </div>
	 <div class="form-row">
	 <div class="form-group">
	 <label>Hƒ±z(km):</label>
	 <input type="number" id="speed" placeholder="Hƒ±z"><br>
	 </div>
	 <div class="form-group">
     <label>Renk:</label>
     <input type="text" id="color" placeholder="Renk">  
      </div>
      </div>
      <button type="button" onClick="saveAnimal('${animalName}')">Kaydet</button>

      </form>`;
  }
  
  function saveAnimal(name){
	    const age = document.getElementById("age").value;
	    const height = document.getElementById("height").value;
	    const weight = document.getElementById("weight").value;
	    const speed = document.getElementById("speed").value;	  
	    const color = document.getElementById("color").value;
	  
	    const animalData = {
	      animalName: name,
	      age: age,
	      height: height,
	      weight: weight,
	      speed: speed,
	      color: color	  
	    };

	    console.log("Hayvan Bilgisi:", animalData);

	    const resultDiv = document.createElement("div");
	  resultDiv.innerHTML=`
	  <form class="list">
	  <h3>${name} Durumu </h3>
	  <ul>
	  <li>Ya≈ü: ${age} yƒ±l</li>
      <li>Boy: ${height} cm</li>
      <li>Kilo: ${weight} kg</li>
      <li>Hƒ±z: ${speed} km/h</li>
      <li>Renk: ${color}</li>
    </ul>
    </form>`;
	  
    const existingResult = document.getElementById("animal-status");
    if(existingResult) existingResult.remove();
    resultDiv.id="animal-status";
    document.body.appendChild(resultDiv);

    fetch("http://localhost:8080/api/animals", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(animalData)
  })
  .then(response => response.json())
  .then(data => {
    console.log("Sunucuya kayƒ±t ba≈üarƒ±lƒ±:", data);
  })
  .catch(error => {
    console.error("Hata olu≈ütu:", error);
  });
    
  }

  function listAnimal() {
	  fetch("http://localhost:8080/api/animals")
	    .then(response => {
	      if (!response.ok) throw new Error("Hayvanlar alƒ±namadƒ±!");
	      return response.json();
	    })
	    .then(data => {
	      const animalList = document.getElementById("animalList");
	      if (dataTable) dataTable.destroy();
	      animalList.innerHTML = "";

	      data.forEach((animal, index) => {
	        const row = document.createElement("tr");
	        row.innerHTML = `
	          <td>${animal.id || "-"}</td>
	          <td>${animal.animalName || "-"}</td>
	          <td>${animal.age || "-"}</td>
	          <td>${animal.height || "-"}</td>
	          <td>${animal.weight || "-"}</td>
	          <td>${animal.speed || "-"}</td>
	          <td>${animal.color || "-"}</td>
	          <td>
	            <button onclick="removeAnimal('${animal.animalName}')">Sil</button>
	            <button onclick="editAnimalFromList('${animal.animalName}')">D√ºzenle</button>
	          </td>`;
	        animalList.appendChild(row);
	      });

	      dataTable = new DataTable("#myTable", {
	        language: {
	          search: "Ara:",
	          lengthMenu: "Sayfada _MENU_ kayƒ±t g√∂ster",
	          info: "_TOTAL_ kayƒ±ttan _START_ - _END_ arasƒ± g√∂steriliyor",
	          infoEmpty: "Kayƒ±t yok",
	          infoFiltered: "(_MAX_ kayƒ±t i√ßinden filtrelendi)",
	          zeroRecords: "E≈üle≈üen kayƒ±t bulunamadƒ±",
	          paginate: {
	            first: "ƒ∞lk",
	            last: "Son",
	            next: "ƒ∞leri",
	            previous: "Geri"
	          }
	        }
	      });
	    })
	    .catch(error => {
	      console.error("Hayvanlarƒ± getirirken hata olu≈ütu:", error);
	      alert("Listeleme sƒ±rasƒ±nda bir hata olu≈ütu.");
	    });
	}
  
  function removeAnimal(name) {
	  const formContainer = document.getElementById("form-container");
	  formContainer.innerHTML = "";

	  fetch(`http://localhost:8080/api/animals/${encodeURIComponent(name)}`, {
	    method: "DELETE"
	  })
	    .then(response => {
	      if (!response.ok) throw new Error("Silme i≈ülemi ba≈üarƒ±sƒ±z!");
	      return response.text();
	    })
	    .then(message => {
	      alert(message);
	      listAnimal(); 
	    })
	    .catch(error => {
	      console.error("Silme hatasƒ±:", error);
	      alert("Silme sƒ±rasƒ±nda hata olu≈ütu.");
	    });
	}
  
  function editAnimalFromList(name) {
	  document.getElementById("animalInput").value = name;
	  editAnimal();
	}
  
  
    
    function remove() {
        const animalName = document.getElementById("animalInput").value.trim();
        const formContainer = document.getElementById("form-container");
        formContainer.innerHTML = ""; 
        if (!animalName) {
          formContainer.innerHTML = "<p style='color:red;'>L√ºtfen silinecek hayvanƒ±n adƒ±nƒ± giriniz!</p>";
          return;
        }
        const url = `http://localhost:8080/api/animals/${encodeURIComponent(animalName)}`;
        fetch(url, { method: "DELETE" })
          .then(response => {
            if (!response.ok) throw new Error("Silme i≈ülemi ba≈üarƒ±sƒ±z oldu!");
            return response.text(); 
          })
          .then(message => {
            formContainer.innerHTML = `<p style="color:green;">${message}</p>`;
          })
          .catch(error => {
            console.error("Silme hatasƒ±:", error);
            formContainer.innerHTML = `<p style="color:red;">Hata: ${error.message}</p>`;
          });
      }

      function editAnimal() {
        const animalName = document.getElementById("animalInput").value.trim();
        const formContainer = document.getElementById("form-container");
        formContainer.innerHTML = "";

        if (!animalName) {
          formContainer.innerHTML = "<p style='color:red;'>L√ºtfen d√ºzeltilecek hayvanƒ±n adƒ±nƒ± giriniz.</p>";
          return;
        }

        const url = `http://localhost:8080/api/animals/${encodeURIComponent(animalName)}`;
        fetch(url)
          .then(response => {
            if (!response.ok) throw new Error("Hayvan bilgileri alƒ±namadƒ±.");
            return response.json();
          })
          .then(data => {
            formContainer.innerHTML = `
              <h2>${animalName} G√ºncelleme Formu</h2>
              <form id="animalForm">
                <div class="form-row">
                  <div class="form-group">
                    <label>Ya≈ü: <input type="number" id="age" value="${data.yas}"></label>
                  </div>
                  <div class="form-group">
                    <label>Boy: <input type="number" id="height" value="${data.boy}"></label>
                  </div>
                  <div class="form-group">
                    <label>Kilo: <input type="number" id="weight" value="${data.kilo}"></label>
                  </div>
                  <div class="form-group">
                    <label>Hƒ±z: <input type="number" id="speed" value="${data.hƒ±z}"></label>
                  </div>
                  <div class="form-group">
                    <label>Renk: <input type="text" id="color" value="${data.renk}"></label>
                  </div>
                </div>
                <button type="button" onclick="updateAnimal('${animalName}')">G√ºncelle</button>
              </form>`;
          })
          .catch(error => {
            formContainer.innerHTML = `<p style="color:red;">Hata: ${error.message}</p>`;
          });
      }
      
      function fillUpdateForm(name) {
    	  document.getElementById("animalInput").value = name;
    	  editAnimal();
    	}

      function updateAnimal(name) {
        const age = document.getElementById("age").value;
        const height = document.getElementById("height").value;
        const weight = document.getElementById("weight").value;
        const speed = document.getElementById("speed").value;
        const color = document.getElementById("color").value;
        const formContainer = document.getElementById("form-container");

        const animalData = {
          animalName: name,
          age: age,
          height: height,
          weight: weight,
          speed: speed,
          color: color
        };

        fetch(`http://localhost:8080/api/animals/${encodeURIComponent(name)}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(animalData)
        })
        .then(response => {
          if (!response.ok) throw new Error("G√ºncelleme ba≈üarƒ±sƒ±z!");
          return response.text();
        })
        .then(msg => {
          formContainer.innerHTML = `<p style="color:green;">${msg}</p>`;
        })
        .catch(error => {
          console.error("G√ºncelleme hatasƒ±:", error);
          formContainer.innerHTML = `<p style="color:red;">Hata: ${error.message}</p>`;
        });
      }
  
  
</script>
</body>

</html>